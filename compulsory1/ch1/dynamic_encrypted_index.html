<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人教版物理必修一第一章第一节 质点、参考系和坐标系 学案</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // 反调试保护
        (function() {
            // 检测开发者工具
            let devtools = false;
            const threshold = 160;
            
            const detectDevTools = () => {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    devtools = true;
                    document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 18px;">检测到开发者工具，页面已锁定</div>';
                }
            };
            
            detectDevTools();
            setInterval(detectDevTools, 1000);
            
            // 禁止右键菜单
            document.addEventListener('contextmenu', (e) => e.preventDefault());
            
            // 禁止文本选择
            document.addEventListener('selectstart', (e) => e.preventDefault());
            
            // 禁止复制
            document.addEventListener('copy', (e) => e.preventDefault());
        })();
        
        async function decryptContent() {
            const keyId = '{{key_id}}';
            const iv = CryptoJS.enc.Base64.parse('{{iv}}');
            const encrypted = '{{encrypted_content}}';
            
            try {
                // 从服务器获取密钥
                const response = await fetch(`/get_key/${keyId}`);
                if (!response.ok) {
                    throw new Error('Failed to get key');
                }
                
                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // 解密密钥（服务器返回的是Base64编码）
                const key = CryptoJS.enc.Base64.parse(data.key);
                
                // 解密内容
                const decrypted = CryptoJS.AES.decrypt(encrypted, key, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });
                
                const html = decrypted.toString(CryptoJS.enc.Utf8);
                
                // 替换当前页面内容
                document.open();
                document.write(html);
                document.close();
            } catch (error) {
                console.error('Decryption failed:', error);
                document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 18px;">页面加载失败，请刷新重试</div>';
            }
        }
        
        // 页面加载后自动解密
        window.addEventListener('load', decryptContent);
    </script>
</head>
<body>
    <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-size: 18px;">
        页面加载中，请稍候...
    </div>
</body>
</html>